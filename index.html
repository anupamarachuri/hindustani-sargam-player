<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hindustani Sargam Player</title>
  <link rel="icon" href="data:,">
  <script src="https://unpkg.com/tone"></script>
  <script src="https://unpkg.com/vexflow/releases/vexflow-debug.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tonejs/midi"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      background: linear-gradient(to bottom right, #ffe066, #f4a261);
      color: #5c2e00;
    }
    h2 {
      text-align: center;
      color: #b24c00;
    }
    textarea, select, input, button {
      width: 100%;
      font-size: 1em;
      margin-top: 10px;
      padding: 10px;
      border: 1px solid #d89216;
      border-radius: 6px;
      background-color: #fff8e1;
      color: #5c2e00;
    }
    button {
      cursor: pointer;
      background-color: #e65100;
      color: white;
      border: none;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #bf360c;
    }
    .button-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .control-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      align-items: center;
    }
    .control-row label {
      flex: 1;
    }
    .control-row input[type="range"] {
      flex: 3;
    }
    .om-symbol {
      font-size: 2em;
      text-align: center;
      margin-bottom: 10px;
    }
    #staff, #indianStaff {
      margin-top: 20px;
      background: #fff3cd;
      padding: 20px;
      border-radius: 8px;
      border-top: 2px solid #d89216;
    }
  </style>
</head>
<body>
  <div class="om-symbol">ğŸ•‰ï¸</div>
  <h2>ğŸ¶ Hindustani Sargam Player ğŸ¶</h2>

  <label for="raagSelect">Select Raag:</label>
  <select id="raagSelect">
    <option value="Yaman">Yaman</option>
    <option value="Bhupali">Bhupali</option>
    <option value="Bhairav">Bhairav</option>
  </select>

  <label for="instrumentSelect">Instrument:</label>
  <select id="instrumentSelect">
    <option value="piano">ğŸ¹ Piano</option>
    <option value="violin">ğŸ» Violin</option>
    <option value="guitar">ğŸ¸ Guitar</option>
  </select>

  <label for="sargamInput">Enter Sargam Notes:</label>
  <textarea id="sargamInput" rows="3" placeholder="e.g. Sa Re Ga Ma Pa Dha Ni Sa'" spellcheck="false"></textarea>

  <label for="lyricsInput">Enter Corresponding Lyrics:</label>
  <textarea id="lyricsInput" rows="2" placeholder="e.g. mohe rang do laal"></textarea>

  <label for="tempo">Tempo (BPM):</label>
  <input type="number" id="tempo" value="80" min="40" max="240">

  <div class="control-row">
    <label for="volumeControl">Instrument Volume:</label>
    <input type="range" id="volumeControl" min="-60" max="0" value="-12">
  </div>

  <div class="control-row">
    <label for="dronePitch">Tanpura Drone Pitch:</label>
    <select id="dronePitch">
      <option value="C3">C</option>
      <option value="D3">D</option>
      <option value="E3">E</option>
      <option value="F3">F</option>
      <option value="G3">G</option>
      <option value="A3">A</option>
      <option value="B3">B</option>
    </select>
  </div>

  <div class="button-row">
    <button onclick="playSargam()">â–¶ï¸ Play</button>
    <button onclick="startTanpura()">ğŸµ Start Tanpura</button>
    <button onclick="stopTanpura()">ğŸ”‡ Stop Tanpura</button>
    <button onclick="startMicInput()">ğŸ™ Start Mic Input</button>
  </div>

  <div id="staff">
    <canvas id="vfCanvas" width="700" height="200"></canvas>
  </div>

<script>
const noteMap = {
  'Sa': 'C4', 'Re': 'D4', 'Ga': 'E4', 'Ma': 'F4', 'Pa': 'G4', 'Dha': 'A4', 'Ni': 'B4',
  "Sa'": 'C5', "Re'": 'D5', "Ga'": 'E5', "Ma'": 'F5', "Pa'": 'G5', "Dha'": 'A5', "Ni'": 'B5'
};

async function playSargam() {
  await Tone.start();
  const synth = new Tone.Synth().toDestination();
  const notes = document.getElementById('sargamInput').value.trim().split(/\s+/);
  const bpm = parseInt(document.getElementById('tempo').value);
  let time = 0;
  const beat = 60 / bpm;

  notes.forEach((sargam, i) => {
    const note = noteMap[sargam] || 'C4';
    synth.triggerAttackRelease(note, '8n', Tone.now() + time);
    time += beat;
  });
}

let tanpura;
function startTanpura() {
  const pitch = document.getElementById('dronePitch').value;
  tanpura = new Tone.Oscillator(pitch, 'sine').toDestination();
  tanpura.volume.value = -20;
  tanpura.start();
}
function stopTanpura() {
  if (tanpura) tanpura.stop();
}

function startMicInput() {
  navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
    const audioContext = Tone.context;
    const mic = audioContext.createMediaStreamSource(stream);
    mic.connect(Tone.Destination);
    alert("Mic started (this demo doesn't process pitch yet).");
  });
}
</script>
</body>
</html>
